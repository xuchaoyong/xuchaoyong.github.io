<!doctype html>
<html class="theme-next use-motion">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>




  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.3.0"/>









    <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.3.0" />




  <title> Satisfy the Real World! </title>
</head>

<body>
  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
    <a href="/" class="brand">
        <span class="logo">
          <i class="icon-logo"></i>
        </span>
        <span class="site-title">Satisfy the Real World!</span>
    </a>
</h1>


  <ul id="menu" class="menu">
    
      
      <li class="menu-item menu-item-home">
        <a href="/">
          <i class="menu-item-icon icon-home"></i> <br />
          Home
        </a>
      </li>
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives">
          <i class="menu-item-icon icon-archives"></i> <br />
          Archives
        </a>
      </li>
    
      
      <li class="menu-item menu-item-tags">
        <a href="/tags">
          <i class="menu-item-icon icon-tags"></i> <br />
          Tags
        </a>
      </li>
    
  </ul>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
            
          

          <div id="posts" class="posts-expand">
            
  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/09/04/require-and-module-in-lua/">
                require and module in lua
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            Posted on 2015-09-03
          
        </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/04/require-and-module-in-lua/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/04/require-and-module-in-lua/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h1 id="1-_require模块发生了什么">1. require模块发生了什么</h1>
<p>在我们的V8资源侧Lua代码中通常将模块使用module封装起来，使用的时候通过require来引用module，然后利用模块名访问module里面的定义变量和方法。那么，在这个require过程中到底发生了什么？在module声明的时候为什么一般要使用package.seeall参数？如下面例子所示</p>
<pre><code><span class="preprocessor">#文件名test.lua</span>
module(<span class="string">"test"</span>, <span class="keyword">package</span>.seeall)

<span class="class"><span class="keyword">class</span> = </span>{}
local localcalss = {}

<span class="function"><span class="keyword">function</span> <span class="title">good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"good"</span>)</span>
<span class="title">end</span>

<span class="title">function</span> <span class="title">class</span><span class="type">:good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"class good"</span>)</span>
<span class="title">end</span></span>
</code></pre><p>通过require模块，调用定义的方法。</p>
<pre><code><span class="comment">#文件名example.lua</span>
<span class="built_in">require</span> <span class="string">"test"</span>

<span class="built_in">local</span> var = test.good()
<span class="built_in">local</span> var1 = test.class.good()
</code></pre><h2 id="2-_为什么能使用test-good()的形式">2. 为什么能使用test.good()的形式</h2>
<p>通过调用以下循环，打印当前环境的全局变量_G表。</p>
<pre><code><span class="comment">#文件名example.lua</span>
<span class="built_in">require</span> <span class="string">"test"</span>

<span class="built_in">local</span> var = test.good()
<span class="built_in">local</span> var1 = test.class.good()

<span class="keyword">for</span> key, <span class="built_in">value</span> <span class="operator">in</span> pairs(_G) <span class="built_in">do</span>
    print(key, <span class="built_in">value</span>)
<span class="function"><span class="keyword">end</span></span>
</code></pre><p>输出：</p>
<pre><code>_VERSION        Lua <span class="number">5.2</span>
<span class="built_in">print</span>   <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060210
setmetatable    <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060890
tostring        <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x805fd10
coroutine       table: <span class="number">0</span>x8c667a0
dofile  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060d90
getmetatable    <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060d20
<span class="keyword">module</span>  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8c66700
math    table: <span class="number">0</span>x8c67f68
loadstring      <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060ac0
package table: <span class="number">0</span>x8c65858
assert  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060e30
debug   table: <span class="number">0</span>x8c67160
ipairs  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060a50
loadfile        <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060c30
<span class="keyword">next</span>    <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060370
<span class="built_in">error</span>   <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x80604d0
test    table: <span class="number">0</span>x8c696e8
arg     table: <span class="number">0</span>x8c68970
rawset  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060080
bit32   table: <span class="number">0</span>x8c660e8
pairs   <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060a30
rawlen  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060150
unpack  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8067da0
string  table: <span class="number">0</span>x8c65d58
require <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8c66740
<span class="keyword">select</span>  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x805ff40
pcall   <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060810
os      table: <span class="number">0</span>x8c66930
xpcall  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060720
_G      table: <span class="number">0</span>x8c65308
rawget  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x80600f0
tonumber        <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x805fd50
collectgarbage  <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060560
io      table: <span class="number">0</span>x8c66b58
type    <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x805fcc0
table   table: <span class="number">0</span>x8c669a8
rawequal        <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x80601b0
load    <span class="function"><span class="keyword">function</span>:</span> <span class="number">0</span>x8060ac0
</code></pre><p>我们发现模块test成为example.lua脚本执行过程中的一个全局变量，继续打印这个表中的元素。</p>
<pre><code><span class="comment">#文件名example.lua</span>
<span class="built_in">require</span> <span class="string">"test"</span>

<span class="built_in">local</span> var = test.good()
<span class="built_in">local</span> var1 = test.class.good()

<span class="keyword">for</span> key, <span class="built_in">value</span> <span class="operator">in</span> pairs(_G) <span class="built_in">do</span>
    print(key, <span class="built_in">value</span>)
<span class="function"><span class="keyword">end</span></span>

<span class="keyword">for</span> key, <span class="built_in">value</span> <span class="operator">in</span> pairs(_G.test) <span class="built_in">do</span>
    print(key, <span class="built_in">value</span>)
<span class="function"><span class="keyword">end</span>    </span>
</code></pre><p>输出：</p>
<pre><code>good    function: <span class="number">0x8aca810</span>
_PACKAGE
class   table: <span class="number">0x8ac6250</span>
_NAME   <span class="keyword">test</span>
_M      table: <span class="number">0x8ac9ba8</span>
</code></pre><p><strong>总结：本质上使用test.good()方法，就是调用全局变量test表中的good函数，而good函数的定义在module里面。</strong></p>
<p>所以推测：<code>require &quot;test&quot;</code>的作用是在当前的全局变量中增加一个test的表，这个表中的元素就是module里面定义的全局变量和函数方法(不包括局部变量，如test里面的局部变量localclass)。</p>
<p>require函数的实现机制有些复杂，这里给出源代码。</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">require</span> <span class="params">(name)</span></span>
    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">package</span>.loaded[name] <span class="keyword">then</span> <span class="comment">-- module not loaded yet?</span>
        <span class="keyword">local</span> loader = findloader(name)
        <span class="keyword">if</span> loader == <span class="keyword">nil</span> <span class="keyword">then</span>
            <span class="built_in">error</span>(<span class="string">"unable to load module "</span> .. name)
        <span class="keyword">end</span>
        <span class="built_in">package</span>.loaded[name] = <span class="keyword">true</span> <span class="comment">-- mark module as loaded</span>
        <span class="keyword">local</span> res = loader(name) <span class="comment">-- initialize module</span>
        <span class="keyword">if</span> res ~= <span class="keyword">nil</span> <span class="keyword">then</span>
            <span class="built_in">package</span>.loaded[name] = res
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="keyword">return</span> <span class="built_in">package</span>.loaded[name]
<span class="keyword">end</span>
</code></pre><h2 id="3-_module做了什么">3. module做了什么</h2>
<p>为什么在定义module的时候要有参数package.seeall？如果去掉这个参数，会发生什么？</p>
<pre><code><span class="preprocessor">#文件名test.lua</span>
module(<span class="string">"test"</span>)

<span class="class"><span class="keyword">class</span> = </span>{}
local localcalss = {}

<span class="function"><span class="keyword">function</span> <span class="title">good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"good"</span>)</span>
<span class="title">end</span>

<span class="title">function</span> <span class="title">class</span><span class="type">:good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"class good"</span>)</span>
<span class="title">end</span></span>
</code></pre><p>执行example.lua，输出</p>
<pre><code>lua: ./test.lua:<span class="number">4</span>: attempt <span class="built_in">to</span> call <span class="built_in">global</span> <span class="string">'print'</span> (<span class="operator">a</span> nil <span class="built_in">value</span>)
stack traceback:
        ./test.lua:<span class="number">4</span>: <span class="operator">in</span> <span class="function"><span class="keyword">function</span> <span class="string">'good'</span></span>
        example.lua:<span class="number">3</span>: <span class="operator">in</span> main chunk
        [C]: <span class="operator">in</span> ?
</code></pre><p>为什么系统函数print在module的定义中不包括package.seeall参数就会报错呢？</p>
<p>这是由Lua脚本的执行环境引起的，默认情况下Lua脚本的执行环境为全局表，即_G。在开头打印_G全局表，可以看到print是_G表中的一个元素，类型为函数。在全局表的执行环境下，直接使用print函数没有问题，Lua执行时会在_G表中查找print这个元素，能够找到。</p>
<p>但是在module中，如果定义时不包括package.seeall参数，那么Lua的执行环境是私有的环境(programing in Lua Chapter14)，其实模块test的定义可以展开module部分。</p>
<pre><code><span class="preprocessor">#文件名test.lua</span>
<span class="preprocessor">#module("test") 等价于</span>

local modname = <span class="string">"test"</span>
local M = {}
_G[modname] = M
<span class="keyword">package</span>.loaded[modname] = M

setfenv(<span class="number">1</span>, M)

<span class="class"><span class="keyword">class</span> = </span>{}
local localcalss = {}

<span class="function"><span class="keyword">function</span> <span class="title">good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"good"</span>)</span>
<span class="title">end</span>

<span class="title">function</span> <span class="title">class</span><span class="type">:good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"class good"</span>)</span>
<span class="title">end</span></span>
</code></pre><p>通过setfenv函数把当前的执行环境切换为M这个表，而在M中没有定义print函数，所以出现错误。</p>
<p>增加package.seeall参数等同于以下代码。</p>
<pre><code><span class="preprocessor">#文件名test.lua</span>
<span class="preprocessor">#module("test") 等价于</span>

local modname = <span class="string">"test"</span>
local M = {}
_G[modname] = M
<span class="keyword">package</span>.loaded[modname] = M

<span class="preprocessor">#设置M表的元表为_G</span>
setmetatable(M, {__index = _G})

setfenv(<span class="number">1</span>, M)

<span class="class"><span class="keyword">class</span> = </span>{}
local localcalss = {}

<span class="function"><span class="keyword">function</span> <span class="title">good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"good"</span>)</span>
<span class="title">end</span>

<span class="title">function</span> <span class="title">class</span><span class="type">:good</span><span class="params">()</span>
  <span class="title">print</span><span class="params">(<span class="string">"class good"</span>)</span>
<span class="title">end</span></span>
</code></pre><p>通过设置M表的元表为_G，当执行print查不到的时候，看是否定义了元表的__index元素，然后在__index指向的表中找到print的方法。</p>
<h2 id="4-_官方不建议使用module关键字">4. 官方不建议使用module关键字</h2>
<h5 id="1-_package-seeall_这种方式破坏了模块的高内聚，原本引入”test”模块只想调用它的good()函数，但是它却可以读写全局属性，例如_“test-os”">1. package.seeall 这种方式破坏了模块的高内聚，原本引入”test”模块只想调用它的good()函数，但是它却可以读写全局属性，例如 “test.os”</h5>
<p>例如，在example.lua中这么写</p>
<pre><code><span class="comment">#文件名：example.lua</span>
<span class="built_in">require</span> <span class="string">"test"</span>

<span class="built_in">local</span> var = test.good()
<span class="built_in">local</span> var1 = test.class.good()

test.io.<span class="built_in">write</span>(<span class="string">"test io write"</span>)
</code></pre><p>输出：</p>
<pre><code>test io <span class="keyword">write</span>
</code></pre><p>这样显然是违背module的本意的。</p>
<h5 id="2-_module函数压栈操作引发的副作用，污染了全局环境变量。例如module(“test”)_会创建一个test的table，并将这个table注入全局环境变量中，这样使得没有引用它的文件也能调用test模块的方法。">2. module函数压栈操作引发的副作用，污染了全局环境变量。例如module(“test”) 会创建一个test的table，并将这个table注入全局环境变量中，这样使得没有引用它的文件也能调用test模块的方法。</h5>
<p>例如，private模块并没有require “test”这个模块，但是它里面却可以通过全局变量表来访问test模块里面的方法。</p>
<pre><code><span class="comment">#文件名private.lua</span>
<span class="class"><span class="keyword">module</span> "<span class="title">private</span>"</span>

_G.test.good()
</code></pre><p>输出：</p>
<pre><code>good
</code></pre><p>在private.lua没有引入test这个module的时候确仍然可以使用全局变量进行访问，这也是不当的。</p>
<p>总结：虽然有以上的问题，但是当前代码仍然采用module的形式。</p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Programming-in-Lua/">
                #Programming in Lua
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/08/20/Strategy/">
                Strategy
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            Posted on 2015-08-20
          
        </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/08/20/Strategy/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/20/Strategy/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h1 id="Intent">Intent</h1>
<p>Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it.</p>
<h1 id="UML">UML</h1>
<p><img src="https://raw.githubusercontent.com/xuchaoyong/images/master/Strategy.JPG" alt="Screen Shot" title="maze map"></p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Design-Pattern/">
                #Design Pattern
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/25/non-blocking-IO/">
                non-blocking IO
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            Posted on 2015-07-25
          
        </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/25/non-blocking-IO/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/07/25/non-blocking-IO/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="1-_Background">1. Background</h2>
<p>By default, sockets are blocking, which means that when we issue a socket call that cannot be completed immediately, our process is put to sleep, waiting for the condition to be true.</p>
<p>However, nonblocking I/O prevents us from blocking while we could be doing something productive.</p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Unix-Networking-Programming/">
                #Unix Networking Programming
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/07/24/open-function-Trap-in-C/">
                open function Trap in C++
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            Posted on 2015-07-24
          
        </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/24/open-function-Trap-in-C/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/07/24/open-function-Trap-in-C/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <h2 id="1-_Background">1. Background</h2>
<p>Give the following code which comes from unixdomain/mycat.c in UNP.</p>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;sys/socket.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;errno.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "unixsock.h"</span>

<span class="keyword">static</span> <span class="keyword">int</span> write_fd(<span class="keyword">int</span> fd, <span class="keyword">void</span> *ptr, <span class="keyword">int</span> nbytes, <span class="keyword">int</span> sendfd);

<span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)
{
    <span class="keyword">int</span> fd;
    <span class="keyword">char</span> fdstr[<span class="number">20</span>];
    <span class="keyword">int</span> value = <span class="number">0</span>;
    <span class="keyword">if</span> (argc != <span class="number">4</span>)
        ERR_RETURN_VALUE(<span class="string">"usage: openfile &lt;sockfd&gt; &lt;filename&gt; &lt;mode&gt;"</span>);

    <span class="keyword">if</span> ((fd = open(argv[<span class="number">2</span>], atoi(argv[<span class="number">3</span>])) &lt; <span class="number">0</span>))
    {
        ERR_RETURN_NOVALUE(<span class="string">"file non-exist"</span>);
        <span class="built_in">exit</span>((errno &gt; <span class="number">0</span>) ? errno : <span class="number">255</span>);
    }

    <span class="keyword">if</span> (write_fd(atoi(argv[<span class="number">1</span>]), <span class="keyword">const_cast</span>&lt;<span class="keyword">char</span> *&gt;(<span class="string">""</span>), <span class="number">1</span>, fd) &lt; <span class="number">0</span>)
    {
        ERR_RETURN_NOVALUE(<span class="string">"write_fd failed"</span>);
        <span class="built_in">exit</span>((errno &gt; <span class="number">0</span>) ? errno : <span class="number">255</span>); 
    }

    close(fd);

}
</code></pre><p>Can you find the bug in the above code?<br>The bug costs me more than 4 hours to figure it out.</p>
<h2 id="2-_Output">2. Output</h2>
<p>The purpose of above code is to transfer a file descriptor from the child process to parent process. Then the parent program will read content the file descriptor. </p>
<p>However, I find that my program could not correctly output the content of the file. </p>
<p>Then I try to write something to the file in the child process and I can read the content in the parent process, which totally confused me.</p>
<p>In the beginning, I think there must be something wrong with the opening mode of the file. Therefore, I used fcntl function to check and change the mode of the descriptor. However, it does not make a little chance.</p>
<p>However, during the procedure, I find a strange matter that I get different mode by using fcntl in two differnt program to get the status of mode.</p>
<p>OK.</p>
<p>I find I just made a so stupid mistake.</p>
<h2 id="3-_Solution">3. Solution</h2>
<pre><code><span class="preprocessor">#<span class="keyword">include</span> &lt;stdio.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;iostream&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;stdlib.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;sys/socket.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> &lt;errno.h&gt;</span>
<span class="preprocessor">#<span class="keyword">include</span> "unixsock.h"</span>

<span class="keyword">static</span> <span class="keyword">int</span> write_fd(<span class="keyword">int</span> fd, <span class="keyword">void</span> *ptr, <span class="keyword">int</span> nbytes, <span class="keyword">int</span> sendfd);

<span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)
{
    <span class="keyword">int</span> fd;
    <span class="keyword">char</span> fdstr[<span class="number">20</span>];
    <span class="keyword">int</span> value = <span class="number">0</span>;
    <span class="keyword">if</span> (argc != <span class="number">4</span>)
        ERR_RETURN_VALUE(<span class="string">"usage: openfile &lt;sockfd&gt; &lt;filename&gt; &lt;mode&gt;"</span>);

    <span class="comment">/*The open function bracket*/</span>
    <span class="keyword">if</span> ((fd = open(argv[<span class="number">2</span>], atoi(argv[<span class="number">3</span>]))) &lt; <span class="number">0</span>)
    {
        ERR_RETURN_NOVALUE(<span class="string">"file non-exist"</span>);
        <span class="built_in">exit</span>((errno &gt; <span class="number">0</span>) ? errno : <span class="number">255</span>);
    }

    <span class="keyword">if</span> (write_fd(atoi(argv[<span class="number">1</span>]), <span class="keyword">const_cast</span>&lt;<span class="keyword">char</span> *&gt;(<span class="string">""</span>), <span class="number">1</span>, fd) &lt; <span class="number">0</span>)
    {
        ERR_RETURN_NOVALUE(<span class="string">"write_fd failed"</span>);
        <span class="built_in">exit</span>((errno &gt; <span class="number">0</span>) ? errno : <span class="number">255</span>); 
    }

    close(fd);

}
</code></pre><p>Wrong Code: <code>(fd = open(argv[2], atoi(argv[3])) &lt; 0)</code></p>
<p>fd = 0, which refers to STDIN. Because open will return 1 which is bigger than zero, fd = 1 &lt; 0 = false = 0.</p>
<p>Right Code: <code>((fd = open(argv[2], atoi(argv[3]))) &lt; 0)</code></p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/C-Programming/">
                #C++ Programming
              </a>
            
          </div>
        

        

        
        
          <div class="post-eof"></div>
        
      </div>
    
  </div>


  
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/04/25/Your-Goal-Should-Be-Quantified/">
                Your Goal Should Be Quantified
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          
            Posted on 2015-04-25
          
        </span>
        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/04/25/Your-Goal-Should-Be-Quantified/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/25/Your-Goal-Should-Be-Quantified/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    
      <div class="post-body">

        
        

        
          
            <p>When you are running, you should count your rounds or length; otherwise, how to show your ability. Therefore, when you are talking about your running project, you should describe it as I have ran 45 rounds or 8 kilormeters. When you review your achievement after some time, you would be certain about what you have done. This experience can be adopted in other fields of your projects.</p>
<p>For example, you are training your programming skills. To be an expert, there are too many identifiers to show your expertise. However, many people are not lucky enough to do big innovation in their jobs; instead, they can coding repeatedly with large quantity of lines of code to show their ability. If you take a conversation with other recruitor, you just say that I have coded nearly one handred thousand lines which will surprise the employers too much. Although you have not made a big difference in the programming world, you just work a lot repeatedly which will certainly build your skills.</p>
<p>Next time when you make a goal for your programming project to be an expert, you should imagine that I will code one thousand one month, which means I need to code three handred of lines per day. Finally, you can talk big about your programming practices.</p>
<p>When you feel hard for your job or persistence, others are also suffer the same situation. If you want to get the chance from other people, you should wait for others’ quit. Then it is time for your show.</p>
<p>Therefore, why you should persist with your goal, the above will answer you well. Others are wait for your quit, then they will get their chance in this harsh world, do you want to gain priority in your world. OK, work hard and persist on your goal project.</p>

          
        
      </div>
    

    
      <div class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/self-Management/">
                #self-Management
              </a>
            
          </div>
        

        

        
        
      </div>
    
  </div>


  

          </div>

          
            <div class="pagination">
              <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
            </div>
          
        </div>

        
<div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>

<div id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    

    <div class="site-overview">
      <div class="site-author motion-element">
        <img class="site-author-image" src="/images/default_avatar.jpg" alt="Charlie" />
        <p class="site-author-name">Charlie</p>
      </div>
      <p class="site-description motion-element"></p>
      <div class="site-state motion-element">
        <div class="site-state-item site-state-posts">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </div>
        <div class="site-state-item site-state-tags">
            <span class="site-state-item-count">10</span>
            <span class="site-state-item-name">tags</span>
        </div>
        <div class="site-state-item site-state-pages">
            <span class="site-state-item-count">1</span>
            <span class="site-state-item-name">pages</span>
        </div>
      </div>

      

      <div class="social-info motion-element">
        
      </div>

      
      

    </div>

    

  </div>
</div>


      </div>
    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Charlie</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT</a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $(".fancybox").fancybox();
    });
  </script>

  <script type="text/javascript">
  function hasMobileUA () {
    var nav = window.navigator;
    var ua = nav.userAgent;
    var pa = /iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;

    return pa.test(ua);
  }

  function isDesktop () {
    return screen.width > 991 && !hasMobileUA();
  }

  function isTablet () {
    return screen.width < 992 && screen.width > 767 && hasMobileUA();
  }

  function isMobile () {
    return screen.width < 767 && hasMobileUA();
  }

  function escapeSelector (selector) {
    return selector.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g, "\\$&")
  }
</script>

  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  
  <script type="text/javascript" id="motion.page.home">
    $(document).ready(function () {
      $.Velocity.RunSequence([
        { e: $('.brand'), p: { opacity: 1 }, o: { duration: 100 } },
        { e: $('.logo'), p: { opacity: 1, top: 0 }, o: { duration: 50} },
        { e: $('.site-title'), p: { opacity: 1, top: 0 }, o: { duration: 200, sequenceQueue: false } }
      ]);
      $('.menu-item').velocity('transition.slideDownIn', {display: null});
    });
  </script>


  <script type="text/javascript" id="motion.global">
  $(document).ready(function () {
    var body = $('body');
    var isSidebarVisible = false;
    var sidebarToggle = $('.sidebar-toggle');
    var sidebarToggleLine1st = $('.sidebar-toggle-line-first')
    var sidebarToggleLine2nd = $('.sidebar-toggle-line-middle');
    var sidebarToggleLine3rd = $('.sidebar-toggle-line-last');
    var sidebar = $('.sidebar');

    var SIDEBAR_WIDTH = '320px';
    var SIDEBAR_DISPLAY_DURATION = 300;

    var sidebarToogleLineStatusInit = {width: '100%', opacity: 1, left: 0, rotateZ: 0, top: 0};

    var sidebarToggleLine1stStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine1stStatusArrow = {width: '50%', rotateZ: '-45deg', top: '2px'};
    var sidebarToogleLine1stStatusClose = {width: '100%', rotateZ: '-45deg', top: '5px'};

    var sidebarToggleLine2ndStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine2ndStatusArrow = {width: '90%'};
    var sidebarToogleLine2ndStatusClose = {opacity: 0};

    var sidebarToggleLine3rdStatusInit = sidebarToogleLineStatusInit;
    var sidebarToggleLine3rdStatusArrow = {width: '50%', rotateZ: '45deg', top: '-2px'};
    var sidebarToogleLine3rdStatusClose = {width: '100%', rotateZ: '45deg', top: '-5px'};

    sidebatToggleMotion();
    postsListMotion();
    backToTopMotion();


    $(document)
      .on('sidebar.isShowing', function () {
        isDesktop() && body.velocity(
          {paddingRight: SIDEBAR_WIDTH},
          SIDEBAR_DISPLAY_DURATION
        );
        sidebarContentMotion();
      })
      .on('sidebar.isHiding', function () {});


    function backToTopMotion () {
      var b2top = $('.back-to-top');
      b2top.on('click', function () {
        body.velocity('scroll');
      });
    }

    function sidebarShowMotion () {

      sidebarToggleLine1st.velocity(sidebarToogleLine1stStatusClose);
      sidebarToggleLine2nd.velocity(sidebarToogleLine2ndStatusClose);
      sidebarToggleLine3rd.velocity(sidebarToogleLine3rdStatusClose);

      sidebar.velocity({width: SIDEBAR_WIDTH}, {
        display: 'block',
        duration: SIDEBAR_DISPLAY_DURATION,
        complete: function () {
          sidebar.addClass('sidebar-active');
          sidebar.trigger('sidebar.didShow');
        }
      });
      sidebar.trigger('sidebar.isShowing');
    }

    function sidebarHideMotion () {
      isDesktop() && body.velocity({paddingRight: 0});
      sidebar.velocity('reverse');

      sidebarToggleLine1st.velocity(sidebarToggleLine1stStatusInit);
      sidebarToggleLine2nd.velocity(sidebarToggleLine2ndStatusInit);
      sidebarToggleLine3rd.velocity(sidebarToggleLine3rdStatusInit);

      sidebar.removeClass('sidebar-active');
      sidebar.trigger('sidebar.isHiding');
    };

    function sidebarContentMotion () {
      $('.sidebar .motion-element').velocity(
        'transition.slideRightIn',
        {stagger: 50, drag: true}
      );
    }

    function postsListMotion () {
      var postMotionOptions = postMotionOptions || {stagger: 300, drag: true};
      $('.post').velocity('transition.slideDownIn', postMotionOptions);
    }

    function sidebatToggleMotion () {
      sidebarToggle.on('click', function () {
        isSidebarVisible ? sidebarHideMotion() : sidebarShowMotion();
        isSidebarVisible = !isSidebarVisible;
      });

      sidebarToggle.hover(function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusArrow);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusArrow);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusArrow);
      }, function () {
        if (isSidebarVisible) {return}
        sidebarToggleLine1st.velocity('stop').velocity(sidebarToggleLine1stStatusInit);
        sidebarToggleLine2nd.velocity('stop').velocity(sidebarToggleLine2ndStatusInit);
        sidebarToggleLine3rd.velocity('stop').velocity(sidebarToggleLine3rdStatusInit);
      });
    }
  });

</script>





  

  

  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"duoshuo-shortname"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
  
</body>
</html>
